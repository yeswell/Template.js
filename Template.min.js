function insert(e,t){let r=get_attr(t,"i",[0,0,Number.MAX_SAFE_INTEGER]);set_attr(t,"i",r+1);let n=e.innerHTML.split("{~}"),i=n.length-1;if(i>0){let u=get_replacements(t,i,r);e.innerHTML=n.reduce((e,t,r)=>e+t+u[r],"")}t[{before:"before",instead:"replaceWith",after:"after"}[get_attr(t,"type",["before","instead","after"])]](e.firstElementChild)}function get_replacements(e,t,r){let n=e.innerHTML.split(/}\s+{/).map(e=>e.trim()),i=n.length-1;n[0]=n[0].slice(1),n[i]=n[i].slice(0,-1),n=n.map(e=>e.split("}{"));let u=[];for(let e=0;t>e;++e)if(i<e)u.push("{~}");else{let t=n[e].length,i=n[e][r%t];if("#"===i.charAt(0)){let l=parse_counter(i);n[e][r%t]=l.string,u.push(l.value)}else u.push(i)}u.push("");let l=n.map(e=>"{"+e.join("}{")+"}");return e.innerHTML=l.join("\n"),u}function get_attr(e,t,r){let n=e.getAttribute(t),i=r[0];switch(typeof i){case"number":let e=Number.parseInt(n);!Number.isSafeInteger(e)||r[1]>e||e>r[2]||(i=e);break;case"string":r.includes(n)&&(i=n)}return i}function set_attr(e,t,r){e.setAttribute(t,r)}function parse_counter(e){let t={value:e,string:e},r=(e=e.slice(1)).lastIndexOf("+"),n=e.lastIndexOf("-"),i=r>0||n>0?Math.max(r,n):0;if(i>0){let r=Number.parseInt(e.slice(0,i)),n=Number.parseInt(e.slice(i));Number.isSafeInteger(r)&&Number.isSafeInteger(n)&&(t.value=r,t.string="#"+(r+n)+(0>n?"":"+")+n)}return t}function create_elem(e){let t=document.createElement("div");return t.innerHTML=e,t.firstElementChild}export default class Template{static copy(e){let t=Array.from(document.getElementById("templates").children),r=t.findIndex(t=>t.hasAttribute("template")&&t.getAttribute("template")===e);return r>-1?create_elem(t[r].outerHTML):void 0}static paste(e,t=document.body,r=0){if(!e.hasAttribute("template"))return!1;let n=e.getAttribute("template"),i=t.querySelectorAll('[include="'+n+'"]');return i.length>r&&(insert(e,i[r]),!0)}static copy_paste(e,t=document.body,r=0){return this.paste(this.copy(e),t,r)}static auto(e=[],t=document.body){let r=Array.from(t.querySelectorAll(":scope > div:not(#templates)")).reduce((e,t)=>{let r=Array.from(t.querySelectorAll("[include]"));let n=Array.from(t.querySelectorAll("[n]"));let i=r.filter(e=>n.includes(e));e.push(...i);return e},[]),n=[];(n=e.length>0?r.filter(t=>e.includes(t.getAttribute("include"))):r).forEach(e=>{let t=e.getAttribute("include");let r=this.copy(t);this.auto([],r.firstElementChild);let n=get_attr(e,"n",[0,0,Number.MAX_SAFE_INTEGER]);for(let t=0;n>t;++t)insert(create_elem(r.outerHTML),e)})}};
